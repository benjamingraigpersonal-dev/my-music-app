<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aura: Infinite Sound</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #0b0b0b; --accent: #1DB954; --panel: #181818; }
        body { background: var(--bg); color: white; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; padding-bottom: 120px; }
        .search-area { display: flex; gap: 8px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #333; background: var(--panel); color: white; outline: none; }
        .btn { background: var(--accent); color: black; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; }
        .track { display: flex; align-items: center; justify-content: space-between; background: var(--panel); padding: 12px; border-radius: 12px; margin-bottom: 8px; }
        .track-name { flex: 1; font-size: 0.9rem; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .add-btn { background: transparent; border: 1px solid var(--accent); color: var(--accent); width: 30px; height: 30px; border-radius: 50%; margin-left: 10px; }
        .player { position: fixed; bottom: 0; left: 0; right: 0; background: #121212; padding: 15px; border-top: 1px solid var(--accent); display: none; }
        audio { width: 100%; height: 40px; margin-top: 10px; filter: invert(1); }
    </style>
</head>
<body>
    <div class="search-area">
        <input type="text" id="q" placeholder="Megadeth...">
        <button class="btn" onclick="search()">üîé</button>
    </div>

    <div id="results"></div>
    <div style="color: #666; font-size: 0.7rem; margin: 20px 0 10px; text-transform: uppercase;">–ú–æ—è –º–µ–¥–∏–∞—Ç–µ–∫–∞</div>
    <div id="library"></div>

    <div class="player" id="player">
        <div id="p-title" style="font-size: 0.8rem; font-weight: bold; color: var(--accent);"></div>
        <audio id="audio" controls></audio>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –¢–í–û–Ø –ê–ö–¢–£–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê –ò–ó –°–ö–†–ò–ù–®–û–¢–ê
        const API = "https://rude-coats-speak.loca.lt";
        const uid = tg.initDataUnsafe.user?.id || 0;

        async function apiFetch(path, options = {}) {
            // –î–æ–±–∞–≤–ª—è–µ–º Bypass-Tunnel-Reminder, —á—Ç–æ–±—ã –Ω–µ –≤—ã–ª–µ—Ç–∞–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø–∞—Ä–æ–ª–µ–º –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const headers = { 
                ...options.headers, 
                'Bypass-Tunnel-Reminder': 'true' 
            };
            return fetch(API + path, { ...options, headers });
        }

        async function search() {
            const query = document.getElementById('q').value;
            if(!query) return;
            const btn = document.querySelector('.btn');
            btn.innerText = "‚è≥";
            
            try {
                const res = await apiFetch(`/search?q=${encodeURIComponent(query)}`);
                const data = await res.json();
                const div = document.getElementById('results');
                div.innerHTML = '';
                
                if (data.length === 0) {
                    div.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                }

                data.forEach(t => {
                    const title = t.title.replace(/['"]/g, "");
                    div.innerHTML += `
                    <div class="track">
                        <div class="track-name" onclick="play('${t.url}', '${title}')">${t.title}</div>
                        <button class="add-btn" onclick="add('${title}', '${t.url}')">+</button>
                    </div>`;
                });
            } catch (e) {
                alert("–°–µ—Ä–≤–µ—Ä Aura –≤—Å—ë –µ—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ Aura.py –∑–∞–ø—É—â–µ–Ω –∏ —Å—Å—ã–ª–∫–∞ –≤ –∫–æ–¥–µ –≤–µ—Ä–Ω–∞.");
            } finally {
                btn.innerText = "üîé";
            }
        }

        async function add(title, url) {
            try {
                await apiFetch('/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: uid, title, url })
                });
                load();
            } catch (e) { console.error(e); }
        }

        async function load() {
            try {
                const res = await apiFetch(`/get?user_id=${uid}`);
                const data = await res.json();
                document.getElementById('library').innerHTML = data.map(t => `
                    <div class="track" onclick="play('${t.url}', '${t.title}')">
                        <div class="track-name">üéµ ${t.title}</div>
                    </div>`).join('');
            } catch (e) {}
        }

        function play(url, title) {
            document.getElementById('player').style.display = 'block';
            document.getElementById('p-title').innerText = "‚ñ∂ " + title;
            const a = document.getElementById('audio');
            a.src = url;
            a.play();
        }

        load();
    </script>
</body>
</html>



