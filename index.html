<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --accent: #00d2ff;
            --text: #ffffff;
        }

        body {
            background: #0f0f0f;
            /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–æ–¥ —Å—Ç–µ–∫–ª–æ–º */
            background: linear-gradient(45deg, #0f0f0f, #1a1a2e, #16213e, #0f0f0f);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        h3 { font-weight: 300; letter-spacing: 1px; margin: 0; }

        .btn-edit {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            text-transform: uppercase;
            transition: 0.3s;
        }

        .btn-edit.active {
            background: rgba(255, 59, 48, 0.3);
            border-color: #ff3b30;
        }

        input#search {
            width: 100%;
            padding: 15px;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            color: white;
            box-sizing: border-box;
            margin-bottom: 25px;
            outline: none;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .folder-name {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 20px 0 10px 10px;
            opacity: 0.7;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 15px;
            position: relative;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –±–ª–∏–∫–∞ –Ω–∞ —Å—Ç–µ–∫–ª–µ */
        .card::before {
            content: "";
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.1), transparent);
            transform: skewX(-25deg);
            transition: 0.5s;
        }

        .card:active { transform: scale(0.95); }
        .card:hover::before { left: 150%; }

        .cover {
            width: 100%;
            aspect-ratio: 1;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .title {
            font-size: 13px;
            font-weight: 400;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 5px;
        }

        .del-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 59, 48, 0.8);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: none;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            z-index: 10;
        }

        .edit-mode .del-badge { display: flex; }
        .edit-mode .card { animation: pulse 1s infinite; }

        @keyframes pulse {
            0% { border-color: var(--glass-border); }
            50% { border-color: rgba(255, 255, 255, 0.5); }
            100% { border-color: var(--glass-border); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h3>STKL PHONK</h3>
        <button id="editBtn" class="btn-edit" onclick="toggleEdit()">–ü—Ä–∞–≤–∏—Ç—å</button>
    </div>
    
    <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –≤ —Ç—É–º–∞–Ω–µ..." oninput="doSearch()">
    
    <div id="content"></div>

    <script>
        let tg = window.Telegram.WebApp;
        let isEdit = false;
        tg.expand();

        const dataStr = new URLSearchParams(window.location.search).get('data');
        const content = document.getElementById('content');

        function toggleEdit() {
            isEdit = !isEdit;
            document.body.classList.toggle('edit-mode', isEdit);
            document.getElementById('editBtn').innerText = isEdit ? '–ì–æ—Ç–æ–≤–æ' : '–ü—Ä–∞–≤–∏—Ç—å';
            document.getElementById('editBtn').classList.toggle('active', isEdit);
        }

        if (dataStr) {
            const musicData = JSON.parse(decodeURIComponent(dataStr));
            for (const folder in musicData) {
                const group = document.createElement('div');
                group.className = 'f-group';
                group.innerHTML = `<div class="folder-name">${folder}</div>`;
                const grid = document.createElement('div');
                grid.className = 'grid';
                musicData[folder].forEach(t => {
                    const card = document.createElement('div');
                    card.className = 'card track';
                    card.dataset.name = t.name.toLowerCase();
                    card.innerHTML = `<div class="del-badge">‚àí</div><div class="cover">üéß</div><div class="title">${t.name}</div>`;
                    card.onclick = () => {
                        const action = isEdit ? "delete" : "play";
                        tg.sendData(JSON.stringify({action, folder, file_id: t.file_id, title: t.name}));
                        tg.close();
                    };
                    grid.appendChild(card);
                });
                group.appendChild(grid);
                content.appendChild(group);
            }
        }

        function doSearch() {
            const q = document.getElementById('search').value.toLowerCase();
            document.querySelectorAll('.track').forEach(t => {
                t.style.display = t.dataset.name.includes(q) ? 'block' : 'none';
            });
        }
    </script>
</body>
</html>

