<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0f0f0f; --card-bg: rgba(255,255,255,0.1); --accent: #00d2ff; --text: #fff;
        }
        /* –¢–µ–º—ã */
        body.purple { --bg: #1a0a2e; --accent: #bf5af2; --card-bg: rgba(191,90,242,0.15); }
        body.cyber { --bg: #000; --accent: #f7e018; --card-bg: rgba(247,224,24,0.1); --text: #f7e018; }

        body {
            background: var(--bg); color: var(--text); font-family: sans-serif;
            margin: 0; padding: 20px; min-height: 100vh; transition: 0.5s;
        }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .theme-select { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 10px; padding: 5px; outline: none; }
        
        .btn-edit { background: var(--card-bg); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 15px; border-radius: 15px; }
        .btn-edit.active { background: rgba(255,59,48,0.5); }

        input#search {
            width: 100%; padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2);
            background: var(--card-bg); backdrop-filter: blur(10px); color: white; margin-bottom: 20px; box-sizing: border-box;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card {
            background: var(--card-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 25px; padding: 15px; text-align: center;
            position: relative; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .cover { 
            aspect-ratio: 1; background: linear-gradient(135deg, var(--accent), transparent); 
            border-radius: 18px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; font-size: 30px;
        }
        .title { font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .del-badge { position: absolute; top: 5px; right: 5px; background: #ff3b30; border-radius: 50%; width: 24px; height: 24px; display: none; align-items: center; justify-content: center; }
        .edit-mode .del-badge { display: flex; }
    </style>
</head>
<body>
    <div class="header">
        <select class="theme-select" onchange="changeTheme(this.value)">
            <option value="default">Glass</option>
            <option value="purple">Purple</option>
            <option value="cyber">Cyber</option>
        </select>
        <button id="editBtn" class="btn-edit" onclick="toggleEdit()">–ü—Ä–∞–≤–∏—Ç—å</button>
    </div>
    
    <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="doSearch()">
    <div id="content"></div>

    <script>
        let tg = window.Telegram.WebApp; let isEdit = false; tg.expand();
        const dataStr = new URLSearchParams(window.location.search).get('data');

        function changeTheme(v) {
            document.body.className = v === 'default' ? '' : v;
            localStorage.setItem('theme', v);
        }

        function toggleEdit() {
            isEdit = !isEdit; document.body.classList.toggle('edit-mode', isEdit);
            document.getElementById('editBtn').innerText = isEdit ? '–ì–æ—Ç–æ–≤–æ' : '–ü—Ä–∞–≤–∏—Ç—å';
            document.getElementById('editBtn').classList.toggle('active', isEdit);
        }

        if (dataStr) {
            const musicData = JSON.parse(decodeURIComponent(dataStr));
            for (const folder in musicData) {
                const group = document.createElement('div');
                group.innerHTML = `<div style="font-size:10px; opacity:0.6; margin:15px 5px;">${folder}</div>`;
                const grid = document.createElement('div'); grid.className = 'grid';
                musicData[folder].forEach(t => {
                    const card = document.createElement('div'); card.className = 'card track'; card.dataset.name = t.name.toLowerCase();
                    card.innerHTML = `<div class="del-badge">‚àí</div><div class="cover">üéß</div><div class="title">${t.name}</div>`;
                    card.onclick = () => {
                        const action = isEdit ? "delete" : "play";
                        tg.sendData(JSON.stringify({action, folder, file_id: t.file_id, title: t.name}));
                        tg.close();
                    };
                    grid.appendChild(card);
                });
                group.appendChild(grid); document.getElementById('content').appendChild(group);
            }
        }

        function doSearch() {
            const q = document.getElementById('search').value.toLowerCase();
            document.querySelectorAll('.track').forEach(t => { t.style.display = t.dataset.name.includes(q) ? 'block' : 'none'; });
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã
        const savedTheme = localStorage.getItem('theme');
        if(savedTheme) { changeTheme(savedTheme); document.querySelector('.theme-select').value = savedTheme; }
    </script>
</body>
</html>

