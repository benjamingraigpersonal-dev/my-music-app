<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Music</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0b0b0b; color: white; font-family: sans-serif; padding: 20px; }
        input { width: 70%; padding: 10px; border-radius: 5px; border: none; }
        button { width: 25%; padding: 10px; background: #2ecc71; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .track { background: #222; margin: 10px 0; padding: 10px; border-radius: 5px; cursor: pointer; }
        #debug { color: #ff5555; font-size: 12px; margin-top: 10px; word-break: break-all; }
    </style>
</head>
<body>
    <div style="display:flex; gap:10px;">
        <input type="text" id="q" placeholder="Megadeth...">
        <button onclick="search()">üîç</button>
    </div>
    <div id="results"></div>
    <div id="debug"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // !!! –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–ï–ñ–£–Æ –°–°–´–õ–ö–£ –ò–ó XTUNNEL !!!
        // –ù–∞–ø—Ä–∏–º–µ—Ä: https://81a92a95...tunnel4.com
        const API_URL = "https://d0b4c0b6-50b1-4124-a272-ca20acd432e0.tunnel4.com";

        async function search() {
            const query = document.getElementById('q').value;
            const debugDiv = document.getElementById('debug');
            const resDiv = document.getElementById('results');
            
            resDiv.innerHTML = "‚è≥...";
            debugDiv.innerText = "";

            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                const response = await fetch(`${API_URL}/search?q=${encodeURIComponent(query)}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª –æ—à–∏–±–∫–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 404 –∏–ª–∏ 500)
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                }

                const data = await response.json();
                resDiv.innerHTML = "";

                if (data.length === 0) {
                    resDiv.innerHTML = "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.";
                    return;
                }

                data.forEach(t => {
                    const div = document.createElement('div');
                    div.className = 'track';
                    div.innerText = `üéµ ${t.title}`;
                    div.onclick = () => tg.openLink(t.url);
                    resDiv.appendChild(div);
                });

            } catch (e) {
                resDiv.innerHTML = "";
                // –í—ã–≤–æ–¥–∏–º –¢–û–ß–ù–£–Æ –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω
                debugDiv.innerText = `FAIL: ${e.message}. –ü—Ä–æ–≤–µ—Ä—å —Å—Å—ã–ª–∫—É API_URL!`;
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è. –°–º. –∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ.");
            }
        }
    </script>
</body>
</html>
